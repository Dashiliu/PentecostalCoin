# Flink 3 种重启策略

## 故障率重启策略

```
ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();
env.setRestartStrategy(RestartStrategies.failureRateRestart(
  3, // max failures per interval
  Time.of(5, TimeUnit.MINUTES), //time interval for measuring failure rate
  Time.of(10, TimeUnit.SECONDS) // delay
));
```

flink-conf.yaml

```
restart-strategy: failure-rate
restart-strategy.failure-rate.max-failures-per-interval: 3
restart-strategy.failure-rate.failure-rate-interval: 5 min
restart-strategy.failure-rate.delay: 10 s
```

| **配置参数**                                  | **描述**                                   | **默认值**       |
| --------------------------------------------- | ------------------------------------------ | ---------------- |
| 重新启动-strategy.failure-rate.max-故障每间隔 | 失败作业之前的给定时间间隔内的最大重启次数 | 1                |
| 重启strategy.failure-rate.failure速率间隔     | 测量故障率的时间间隔。                     | 1分钟            |
| 重启strategy.failure-rate.delay               | 两次连续重启尝试之间的延迟                 | akka.ask.timeout |



## 固定延迟重启策略

```
ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();
env.setRestartStrategy(RestartStrategies.fixedDelayRestart(
  3, // number of restart attempts
  Time.of(10, TimeUnit.SECONDS) // delay
));
```

flink-conf.yaml

```
restart-strategy: fixed-delay
restart-strategy.fixed-delay.attempts: 3
restart-strategy.fixed-delay.delay: 10 s
```

| 配置参数                              | **描述**                                                     | **默认值**                                     |
| ------------------------------------- | ------------------------------------------------------------ | ---------------------------------------------- |
| restart-strategy.fixed-delay.attempts | Flink在作业声明失败之前重试执行的次数。                      | 1或者Integer.MAX_VALUE如果通过检查点激活       |
| restart-strategy.fixed-delay.delay    | 延迟重试意味着在执行失败后，重新执行不会立即开始，而是仅在一定延迟之后。当程序与外部系统交互时，延迟重试可能会有所帮助，例如，在尝试重新执行之前，连接或待处理事务应达到超时。 | akka.ask.timeout，如果通过检查点激活，则为10秒 |



## 没有重启策略

```
ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();
env.setRestartStrategy(RestartStrategies.noRestart());
```

flink-conf.yaml

```
restart-strategy: none
```



## 资源管理框架重启策略

yarn任务重启机制